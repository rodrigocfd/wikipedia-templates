<html>
<head>
<meta charset="UTF-8"/>
<meta name="author" content="Rodrigo César de Freitas Dias"/>
<link rel="icon" href="favicon.ico"/>
<title>Geocoordenadas</title>
<link type="text/css" rel="stylesheet" href="dress.css"/>
<script src="https://code.jquery.com/jquery-2.2.3.min.js"></script>
<script>
$(document).ready(function() {
	$('#output').hide();
	$('#output2').hide();
	$('#gmaps').focus();

	$('form').submit(function() {
		var gmaps = $('#gmaps').val();
		var z = null;

		if (gmaps.length > 0) {
			var ll = urlparm(gmaps, 'll').split(',', 2);
			$('#lat').val(ll[0]);
			$('#lng').val(ll[1]);
			z = urlparm(gmaps, 'z');
		}

		var floats = { lat:parseFloat($('#lat').val()), lng:parseFloat($('#lng').val()) };
		var lat = getdms(floats.lat);
		var lng = getdms(floats.lng);

		var code = '{{geocoordenadas|' +
			lat.d + '_' + lat.m + '_' + lat.s.toFixed(4).replace('.', ',') + (lat.dec < 0 ? '_S' : '_N') + '_' +
			lng.d + '_' + lng.m + '_' + lng.s.toFixed(4).replace('.', ',') + (lng.dec < 0 ? '_W' : '_E') + '|' +
			lat.d + '°' + lat.m + '’' + Math.round(lat.s) + '”' + (lat.dec < 0 ? 'S' : 'N') + ', ' +
			lng.d + '°' + lng.m + '’' + Math.round(lng.s) + '”' + (lng.dec < 0 ? 'O' : 'L') + '}}';

		var scales = [ null, 100000000, 90000000, 50000000, 30000000, 12000000, 6000000, 3000000, 1500000, 800000,
			5000000, 3000000, 120000, 80000, 40000, 20000, 10000, 4000, 1500, 1000 ];

		var code2 = '{{Coor dms' +
			'|' + Math.abs(floats.lat) + '|||' + (floats.lat < 0 ? 'S' : 'N') +
			'|' + Math.abs(floats.lng) + '|||' + (floats.lng < 0 ? 'O' : 'L') +
			'|display=title' +
			(z !== null ? '|escala=' + scales[z] : '') +
			'}}';

		$('#output').val(code).show();
		$('#output2').val(code2).show().focus().select();

		var gmapslnk = 'http://maps.google.com/maps?ll=' +
			$('#lat').val() + ',' + $('#lng').val() + '&spn=0.01,0.01&q=' +
			$('#lat').val() + ',' + $('#lng').val() + '&z=' + z;

		$('#gmapslnk').html('<a href="' + gmapslnk + '">' + gmapslnk + '</a>');

		return false;
	});

	$('input[value=Limpar]').click(function() {
		$('#gmaps').val('');
		$('#lat').val('');
		$('#lng').val('');
		$('#gmapslnk').html('');
		$('#output').val('').hide();
		$('#output2').val('').hide();
		$('#gmaps').focus();
	});

	$('#output').click(function() { $(this).select(); });
	$('#output2').click(function() { $(this).select(); });

	function urlparm(url, parm) {
		var idx = url.indexOf('?' + parm + '=');
		if (idx == -1) idx = url.indexOf('&' + parm + '=');
		if (idx == -1) return null;
		url = url.substring(idx + parm.length + 2);
		var idx = url.indexOf('&');
		if (idx == -1) return url;
		return url.substring(0, idx);
	}

	function getdms(decimal) {
		var ret = { dec:decimal, d:0, m:0, s:0 };
		decimal = Math.abs(decimal);
		ret.d = Math.floor(decimal);
		ret.m = Math.floor((decimal % 1) * 60);
		ret.s = (((decimal % 1) * 60) % 1) * 60;
		return ret;
	}
});
</script>
</head>

<body>
	<h2>predefinição:geocoordenadas</h2>

	<form>
		<p>Google Maps <input type="text" size="100" id="gmaps"/><br/>
			Latitude (N–S): <input type="text" id="lat"/><br/>
			Longitude (L–O): <input type="text" id="lng"/><br/>
			<input type="submit" value="Processar"/>
			<input type="button" value="Limpar"/></p>
	</form>

	<div id="gmapslnk"></div>
	<br/>
	<input type="text" id="output" size="75"/><br/>
	<input type="text" id="output2" size="75"/>
	<p><a href="index.html">voltar</a></p>
</body>
</html>