<html>
<head>
<meta charset="UTF-8"/>
<meta name="author" content="Rodrigo César de Freitas Dias"/>
<link rel="icon" href="favicon.ico"/>
<title>Geocoordenadas</title>
<link type="text/css" rel="stylesheet" href="dress.css"/>
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script>
$(document).ready(function() {
	$('[id^=output],#osm').hide();
	$('#latlng').focus();

	$('form').submit(function() {
		/*var gmaps = $('#gmaps').val();
		var z = null;
		if (gmaps.length > 0) {
			var ll = urlparm(gmaps, 'll').split(',', 2);
			$('#lat').val(ll[0]);
			$('#lng').val(ll[1]);
			z = urlparm(gmaps, 'z');
		}*/

		var latlng = $('#latlng').val().split(',');
		var floats = { lat: parseFloat(latlng[0]), lng: parseFloat(latlng[1]) };
		var lat = getdms(floats.lat);
		var lng = getdms(floats.lng);

		var code = '{{geocoordenadas|' +
			lat.d + '_' + lat.m + '_' + lat.s.toFixed(4).replace('.', ',') + (lat.dec < 0 ? '_S' : '_N') + '_' +
			lng.d + '_' + lng.m + '_' + lng.s.toFixed(4).replace('.', ',') + (lng.dec < 0 ? '_W' : '_E') + '|' +
			lat.d + '°' + lat.m + '’' + Math.round(lat.s) + '”' + (lat.dec < 0 ? 'S' : 'N') + ', ' +
			lng.d + '°' + lng.m + '’' + Math.round(lng.s) + '”' + (lng.dec < 0 ? 'O' : 'L') + '}}';

		//var scales = [ null, 100000000, 90000000, 50000000, 30000000, 12000000, 6000000, 3000000, 1500000, 800000,
			//5000000, 3000000, 120000, 80000, 40000, 20000, 10000, 4000, 1500, 1000 ];

		var code2 = '{{Coor dms' +
			'|' + Math.abs(floats.lat) + '|||' + (floats.lat < 0 ? 'S' : 'N') +
			'|' + Math.abs(floats.lng) + '|||' + (floats.lng < 0 ? 'O' : 'L') +
			'|display=title' +
			//(z !== null ? '|escala=' + scales[z] : '') +
			'}}';

		var code3 = '{{Coor dms' +
			'|' + lat.d + '|' + lat.m + '|' + decpl(lat.s, 2) + '|' + (floats.lat < 0 ? 'S' : 'N') +
			'|' + lng.d + '|' + lng.m + '|' + decpl(lng.s, 2) + '|' + (floats.lng < 0 ? 'O' : 'L') +
			'|display=title' +
			//(z !== null ? '|escala=' + scales[z] : '') +
			'}}';

		$('#output').val(code).show();
		$('#output2').val(code2).show();
		$('#output3').val(code3).show().focus().select();

		var gmapslnk = 'http://maps.google.com/maps?ll=' +
			latlng[0] + ',' + latlng[1] + '&spn=0.01,0.01&q=' +
			latlng[0] + ',' + latlng[1];// + '&z=' + z;
		$('#gmapslnk').html('<a href="' + gmapslnk + '">' + gmapslnk + '</a>');

		$('#osm').attr('src', 'http://www.openstreetmap.org/export/embed.html?bbox=' +
			floats.lng + '%2C' + floats.lat + '%2C' +
			floats.lng + '%2C' + floats.lat + '&amp;layer=mapnik').show();

		return false;
	});

	$('input[value=Limpar]').click(function() {
		$('#latlng').val('').focus();
		$('#gmapslnk').html('');
		$('[id^=output]').val('').hide();
		$('#osm').attr('src', '').hide();
	});

	$('[id^=output]').click(function() { $(this).select(); });

	function getdms(decimal) {
		var ret = { dec:decimal, d:0, m:0, s:0 };
		decimal = Math.abs(decimal);
		ret.d = Math.floor(decimal);
		ret.m = Math.floor((decimal % 1) * 60);
		ret.s = (((decimal % 1) * 60) % 1) * 60;
		return ret;
	}

	function decpl(nFloat, maxPlaces) {
		var n = '' + nFloat.toFixed(maxPlaces);
		while (n[n.length - 1] === '0') {
			n = n.substr(0, n.length - 1);
		}
		return parseFloat(n);
	}
});
</script>
</head>

<body>
	<h2>predefinição:geocoordenadas</h2>

	<form>
		<p>
		Latitude (N–S), longitude (L–O): <input type="text" id="latlng" size="30"/><br/>
		<input type="submit" value="Processar"/>
		<input type="button" value="Limpar"/>
		</p>
	</form>

	<div id="gmapslnk"></div>
	<br/>
	<input type="text" id="output" size="80"/><br/>
	<input type="text" id="output2" size="80"/><br/>
	<input type="text" id="output3" size="80"/>

	<iframe id="osm" width="650" height="350" frameborder="0" scrolling="no" marginheight="0" marginwidth="0"
		src="" style="margin-top:18px; border:1px solid #AAA;"></iframe>

	<p><a href="index.html">voltar</a></p>
</body>
</html>