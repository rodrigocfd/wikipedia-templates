<html>
<head>
<meta charset="UTF-8"/>
<meta name="author" content="Rodrigo César de Freitas Dias"/>
<link rel="icon" href="favicon.ico"/>
<title>Coor dms</title>
<link type="text/css" rel="stylesheet" href="dress.css"/>
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="util.js"></script>
<script>
$(document).ready(function() {
	$('[id^=output],#osm').hide();
	$('#latlng').focus();

	$('form').submit(function() {
		var userTyped = $('#latlng').val();
		if (!userTyped.length) {
			alert('Sem coordenadas.');
			$('#latlng').focus();
		} else {
			var latlng = userTyped.split(',');
			var floats = { lat: parseFloat(latlng[0]), lng: parseFloat(latlng[1]) };
			var lat = getdms(floats.lat);
			var lng = getdms(floats.lng);

			//var code = ('{{geocoordenadas' +
				//'|%d_%d_%d_%s_%d_%d_%d_%s' +
				//'|%d°%d’%d”%s, %d°%d’%d”%s}}').format(
					//lat.d, lat.m, lat.s.toFixed(4).replace('.', ','), (lat.dec < 0 ? 'S' : 'N'),
					//lng.d, lng.m, lng.s.toFixed(4).replace('.', ','), (lng.dec < 0 ? 'W' : 'E'),
					//lat.d, lat.m, Math.round(lat.s), (lat.dec < 0 ? 'S' : 'N'),
					//lng.d, lng.m, Math.round(lng.s), (lng.dec < 0 ? 'O' : 'L'));

			var code2 = ('{{Coor dms' +
				'|%d|||%s' +
				'|%d|||%s' +
				'|display=title}}').format(
					Math.abs(floats.lat), (floats.lat < 0 ? 'S' : 'N'),
					Math.abs(floats.lng), (floats.lng < 0 ? 'O' : 'L'));

			var code3 = ('{{Coor dms' +
				'|%d|%d|%d|%s' +
				'|%d|%d|%d|%s' +
				'|display=title}}').format(
					lat.d, lat.m, decpl(lat.s, 2), (floats.lat < 0 ? 'S' : 'N'),
					lng.d, lng.m, decpl(lng.s, 2), (floats.lng < 0 ? 'O' : 'L'));

			//$('#output').val(code).show();
			$('#output2').val(code2).show();
			$('#output3').val(code3).show().focus().select();

			var gmapslnk = 'http://maps.google.com/maps?ll=%d,%d&spn=0.01,0.01&q=%d,%d'.format(
				latlng[0], latlng[1], latlng[0], latlng[1]);
			$('#gmapslnk').html('<a href="%s">%s</a>'.format(gmapslnk, gmapslnk));

			$('#osm').attr('src', 'http://www.openstreetmap.org/export/embed.html?bbox=' +
				floats.lng + '%2C' + floats.lat + '%2C' +
				floats.lng + '%2C' + floats.lat + '&amp;layer=mapnik').show();
		}
		return false;
	});

	$('input[value=Limpar]').click(function() {
		$('#latlng').val('').focus();
		$('#gmapslnk').html('');
		$('[id^=output]').val('').hide();
		$('#osm').attr('src', '').hide();
	});

	$('[id^=output]').click(function() { $(this).select(); });

	function getdms(decimal) {
		var ret = { dec:decimal, d:0, m:0, s:0 };
		decimal = Math.abs(decimal);
		ret.d = Math.floor(decimal);
		ret.m = Math.floor((decimal % 1) * 60);
		ret.s = (((decimal % 1) * 60) % 1) * 60;
		return ret;
	}

	function decpl(nFloat, maxPlaces) {
		var n = '' + nFloat.toFixed(maxPlaces);
		while (n[n.length - 1] === '0') {
			n = n.substr(0, n.length - 1);
		}
		return parseFloat(n);
	}
});
</script>
</head>

<body>
	<h2>predefinição:Coor dms</h2>

	<form>
		<p>Latitude (N&ndash;S), longitude (L&ndash;O):
			<input type="text" id="latlng" size="30"/><br/>
			<input type="submit" value="Processar"/>
			<input type="button" value="Limpar"/>
		</p>
	</form>

	<div id="gmapslnk"></div>
	<br/>
	<!--input type="text" id="output" size="80"/><br/-->
	<input type="text" id="output2" size="80"/><br/>
	<input type="text" id="output3" size="80"/>

	<iframe id="osm" width="650" height="350" src=""
		frameborder="0" scrolling="no" marginheight="0" marginwidth="0"
		style="margin-top:18px; border:1px solid #AAA;"></iframe>

	<p><a href="index.html">voltar</a> |
		<a href="https://pt.wikipedia.org/wiki/Predefini%C3%A7%C3%A3o:Coor_dms">docs</a>
	</p>
</body>
</html>